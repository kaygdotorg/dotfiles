# Standalone tmux configuration ‚Äî Catppuccin Mocha pill theme
#
# Replaces oh-my-tmux framework. All settings are direct tmux commands.
#
# CATPPUCCIN MOCHA PALETTE
#   Base     #1e1e2e   Mantle   #181825   Crust    #11111b
#   Surface0 #313244   Surface1 #45475a   Surface2 #585b70
#   Overlay0 #6c7086   Overlay1 #7f849c   Overlay2 #9399b2
#   Text     #cdd6f4   Subtext1 #bac2de   Subtext0 #a6adc8
#   Mauve    #cba6f7   Blue     #89b4fa   Lavender #b4befe
#   Yellow   #f9e2af   Peach    #fab387   Red      #f38ba8
#   Green    #a6e3a1   Teal     #94e2d5   Sky      #89dceb
#
# FONT: Cascadia Code NF (Nerd Font)
#   Pill caps use Powerline Extra glyphs E0B6 (left) / E0B4 (right)
#   as literal UTF-8 characters below.


# -- options -------------------------------------------------------------------

set -g history-limit 50000
set -g mouse on
set -g focus-events on
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g set-titles on
set -g set-titles-string '#h ‚óÜ #S ‚óè #I #W'


# -- terminal ------------------------------------------------------------------

set -g default-terminal "tmux-256color"

# set -g resets the list; subsequent -ga appends. On reload, -g resets again.
set  -g  terminal-features "xterm*:clipboard:ccolour:cstyle:focus:title"
set -ga  terminal-features ",screen*:title"
set -ga  terminal-features ",rxvt*:ignorefkeys"
set -ga  terminal-features ",xterm-256color:RGB"
set -ga  terminal-features ",tmux-256color:clipboard"


# -- clipboard ----------------------------------------------------------------

set -g set-clipboard on
set -g allow-passthrough on


# -- prefix --------------------------------------------------------------------

set -g prefix C-t
set -g prefix2 None
bind C-t send-prefix


# -- key bindings --------------------------------------------------------------

# pane navigation (vim-style)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# pane resizing
bind -r H resize-pane -L 2
bind -r J resize-pane -D 2
bind -r K resize-pane -U 2
bind -r L resize-pane -R 2

# split panes with current path
bind - split-window -v -c "#{pane_current_path}"
bind _ split-window -h -c "#{pane_current_path}"

# swap windows
bind -r < swap-window -d -t -1
bind -r > swap-window -d -t +1

# last window
bind Tab last-window

# new session prompt
bind C-c command-prompt -p "new session:" "new-session -s '%%'"

# reload config
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded"

# toggle mouse
bind m set -g mouse \; display "mouse #{?mouse,on,off}"

# enter copy mode
bind Enter copy-mode


# -- copy mode (vi) ------------------------------------------------------------

set -g mode-keys vi

bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi C-v send -X rectangle-toggle
bind -T copy-mode-vi y send -X copy-pipe-and-cancel
bind -T copy-mode-vi Escape send -X cancel
bind -T copy-mode-vi H send -X start-of-line
bind -T copy-mode-vi L send -X end-of-line

# mouse copy also uses copy-pipe-and-cancel for OSC 52
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel
bind -T copy-mode-vi DoubleClick1Pane select-pane \; send -X select-word \; run -d 0.3 \; send -X copy-pipe-and-cancel
bind -T copy-mode-vi TripleClick1Pane select-pane \; send -X select-line \; run -d 0.3 \; send -X copy-pipe-and-cancel


# -- appearance ----------------------------------------------------------------

# fat pane borders (bg=fg for solid stripe)
set -g pane-border-style        'fg=#313244,bg=#313244'
set -g pane-active-border-style 'fg=#cba6f7,bg=#cba6f7'
set -g pane-border-indicators   colour

# messages (catppuccin yellow)
set -g message-style            'fg=#1e1e2e,bg=#f9e2af,bold'
set -g message-command-style    'fg=#f9e2af,bg=#1e1e2e,bold'

# copy/search mode
set -g mode-style               'fg=#1e1e2e,bg=#f9e2af,bold'

# clock
set -g clock-mode-colour        '#89b4fa'
set -g clock-mode-style         24


# -- status bar ----------------------------------------------------------------

# transparent background (terminal wallpaper shows through)
set -g status on
set -g status-style 'fg=#cdd6f4,bg=default'

# status left: path pill
#   sed replaces $HOME with ~ for pretty path display
set -g status-left '#[fg=#313244,bg=default]ÓÇ∂#[fg=#cdd6f4,bg=#313244] #(echo "#{pane_current_path}" | sed "s|$HOME|~|") #[fg=#313244,bg=default]ÓÇ¥ '
set -g status-left-length 60

# status right: indicators + session pill + user@host pill
#   #{?client_prefix,...}  replaces oh-my-tmux's #{prefix}
#   #{?session_many_attached,...}  replaces #{pairing}
#   #{?pane_synchronized,...}  replaces #{synchronized}
set -g status-right '#{?client_prefix,‚å® , }#{?session_many_attached,üëì , }#{?pane_synchronized,üîí , }#[fg=#cba6f7,bg=default]ÓÇ∂#[fg=#1e1e2e,bg=#cba6f7,bold] ‚óÜ #S #[fg=#cba6f7,bg=default]ÓÇ¥ #[fg=#313244,bg=default]ÓÇ∂#[fg=#cdd6f4,bg=#313244] #(whoami)@#h #[fg=#313244,bg=default]ÓÇ¥ '
set -g status-right-length 80

# window tabs (inactive pill ‚Äî surface2)
setw -g window-status-style 'fg=#585b70,bg=default'
setw -g window-status-format '#[fg=#585b70,bg=default]ÓÇ∂#[fg=#9399b2,bg=#585b70] #I #W #[fg=#585b70,bg=default]ÓÇ¥'

# window tabs (active pill ‚Äî lavender)
setw -g window-status-current-style 'fg=#b4befe,bg=default'
setw -g window-status-current-format '#[fg=#b4befe,bg=default]ÓÇ∂#[fg=#1e1e2e,bg=#b4befe,bold] #I #W #[fg=#b4befe,bg=default]ÓÇ¥'

# window separator (space between pills)
setw -g window-status-separator ' '

# activity / bell
setw -g window-status-activity-style 'fg=default,bg=default,underscore'
setw -g window-status-bell-style 'fg=#f38ba8,bg=default,blink,bold'


# -- SSH detection -------------------------------------------------------------

# lower escape-time for local; higher for SSH (mobile latency)
if-shell '[ -n "$SSH_CLIENT" ] || [ -n "$SSH_TTY" ]' \
  'set -sg escape-time 50' \
  'set -sg escape-time 10'

# fewer status refreshes over SSH
if-shell '[ -n "$SSH_CLIENT" ] || [ -n "$SSH_TTY" ]' \
  'set -g status-interval 60' \
  'set -g status-interval 15'

# status bar position: top locally, bottom over SSH
if-shell '[ -n "$SSH_CLIENT" ] || [ -n "$SSH_TTY" ]' \
  'set -g status-position bottom' \
  'set -g status-position top'


# -- plugins -------------------------------------------------------------------

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'Morantron/tmux-fingers'
set -g @fingers-key F

# Initialize tpm (must be last line)
run 'test -f ~/.config/tmux/plugins/tpm/tpm && ~/.config/tmux/plugins/tpm/tpm'
